#!/bin/bash

# Exit on any error
set -e

# Colors for output
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m' # No Color
BOLD='\033[1m'

echo -e "${BOLD}Running Flutter tests with coverage...${NC}"

# Run tests with coverage and show detailed output
if flutter test --coverage --reporter expanded; then
    echo -e "\n${GREEN}✓ Tests completed successfully${NC}\n"
else
    echo -e "\n${RED}✗ Tests failed${NC}\n"
    exit 1
fi

echo -e "${BOLD}Generating coverage report (excluding types folder)...${NC}"

# Remove types folder from coverage report
lcov --remove coverage/lcov.info 'lib/src/types/*' -o coverage/lcov.info > /dev/null

echo -e "${BOLD}Coverage Report:${NC}\n"
# Display coverage report
lcov --list coverage/lcov.info 